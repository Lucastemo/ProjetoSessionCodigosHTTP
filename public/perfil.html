<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <nav>
        <h1>Códigos HTTP</h1>
        <h2 id="userName"></h2>
        <a onclick="logout()">Sair</a>
    </nav>

    <div class="explorar escondido" onclick="mostraEscondeExplorar()">
        <h3>Explorar</h3>
        <a href="./codStatus/400.html?status=cod400" class="link titleLink c400title hovereable-link">Código 400</a>
        <div class="cod400">
            <a href="./codStatus/400.html?status=cod401" class="link hovereable-link">401 Unauthorized</a>
            <a href="./codStatus/400.html?status=cod403" class="link hovereable-link">403 Forbidden</a>
            <a href="./codStatus/400.html?status=cod405" class="link hovereable-link">405 Method Not Allowed</a>
            <a href="./codStatus/400.html?status=cod409" class="link hovereable-link">409 Conflict</a>
            <a href="./codStatus/400.html?status=cod429" class="link hovereable-link">429 Too Many Requests</a>
        </div>
        <a href="./codStatus/500.html?status=cod500" class="link titleLink c500title hovereable-link">Código 500</a>
        <div class="cod500">
            <a href="./codStatus/500.html?status=cod501" class="link hovereable-link">501 Not Implemented</a>
            <a href="./codStatus/500.html?status=cod502" class="link hovereable-link">502 Bad Gateway</a>
            <a href="./codStatus/500.html?status=cod503" class="link hovereable-link">503 Service Unavailable</a>
            <a href="./codStatus/500.html?status=cod504" class="link hovereable-link">504 Gateway Timeout</a>
            <a href="./codStatus/500.html?status=cod505" class="link hovereable-link">505 HTTP Version Not Supported</a>
        </div>
    </div>
    <div id="contentDiv" style="display: none;">
        <h2>Perfil</h2>
        <div>
            <p id="perfilMsg"></p>
            <button onclick="logout()">Logout</button>
        </div>
    </div>

    <script>
        const baseUrl = 'http://localhost:3000';
        let mostrar = false;

        async function onLoad() {
            const res = await fetch(`${baseUrl}/perfil`, {
                method: 'GET',
                credentials: 'include'
            })
            const text = await res.text();
            if (text.trim() != "") {
                const userName = text.slice(0, 1).toUpperCase() + text.slice(1, text.length).toLowerCase();
                document.getElementById('contentDiv').style.display = 'block';
                document.getElementById('perfilMsg').innerText = userName;
                document.getElementById('userName').innerText = userName;
            } else {
                alert('Você não está logado');
                window.location.href = '/index.html';
            }
        }

        async function logout() {
            const res = await fetch(`${baseUrl}/logout`, {
                method: 'GET',
                credentials: 'include'
            });
            const text = await res.text();
            alert(text);
            window.location.href = '/index.html';
        }

        document.addEventListener('DOMContentLoaded', async function () {
            await onLoad();
        });

        function mostraEscondeExplorar() {
            mostrar = !mostrar;
            if (mostrar) {
                document.getElementsByClassName('explorar')[0].classList = "explorar";
            } else {
                setTimeout(() => {
                    document.getElementsByClassName('explorar')[0].classList = "explorar escondido";
                }, 200);
            }
        }


    </script>
</body>

</html>